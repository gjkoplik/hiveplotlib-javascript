# Hiveplotlib-JavaScript Change Log

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/).

# 0.2.0 (Unreleased)

Formalized support for the full `hiveplotlib` visual keyword arguments, added a test suite, and modernized the project tooling.

## Added

- Full handling of `hiveplotlib` edge kwargs: `color`, `alpha`, `linewidth`, `linestyle`, and
  colormap (`cmap`/`array`/`clim`) — all now rendered faithfully in SVG.
- Support for data-dependent edge kwargs: edge kwargs whose values reference a column name in the
  edge data (e.g. `array="low"`) are resolved to per-edge numeric arrays by `HivePlot.to_json()`;
  the JS renderer handles these arrays seamlessly via the existing `array`+`cmap`+`clim` colormap
  path. The `full_kwargs_hive_plot.json` fixture now demonstrates this pattern.
- Full handling of `hiveplotlib` node kwargs: fill color (`facecolor`/`color`/`c`), `size`/`s`,
  `alpha`, `edgecolor`, and colormap support.
- Kwarg normalization utilities (`normalizeEdgeKwargs`, `normalizeNodeKwargs`) to handle
  matplotlib alias resolution (e.g. `lw` -> `linewidth`, `ls` -> `linestyle`).
- `linestyleToDasharray` helper mapping matplotlib linestyle strings to SVG `stroke-dasharray`
  values.
- `cmapToD3Interpolator` mapping of 30+ matplotlib colormap names to D3 interpolators.
- `scatterSizeToRadius` converter from matplotlib scatter area units to SVG circle radii.
- `plotLabels` function for rendering axis labels, using `long_name` and `angle` from the JSON
  export with configurable buffer, font size, and alignment.
- `visualizeHivePlot` now accepts in-memory JavaScript objects in addition to file paths / URLs.
- `options` parameter on `visualizeHivePlot` (`showLabels`, `labelsBuffer`, `fontSize`).

## Changed

- `visualizeHivePlot` is now `async` and returns `Promise<SVG selection>`. When called with a
  URL string, it now `await`s the data load before rendering, so callers can reliably interact
  with the SVG immediately after `await visualizeHivePlot(...)`.
- `visualizeHivePlot` first parameter renamed from `hiveplotlibOutputFile` to `hiveplotlibOutput` to reflect that it now accepts both strings and objects.
- `plotEdges` now reads all edge kwargs from the JSON instead of hard-coding color; gracefully skips entries with no edge data.
- `plotNodes` uses `selectAll(null)` to avoid D3 data-join conflicts across axes; reads `node_viz_kwargs` for per-axis styling.
- `plotAxes` adds `stroke-opacity: 0.5` and removes unnecessary `.datum()` binding.
- Replaced `var` with `const`/`let` throughout.
- Updated `example_hive_plot.json` to include `angle`, `long_name`, `node_viz_kwargs`, and `edge_kwargs` fields from `hiveplotlib >= 0.26.0`.

## Tooling Changes

- Vitest test suite (`tests/hive_plots_d3_viz.test.js`) running against jsdom, covering kwarg
  normalization, colormap mapping, linestyle mapping, and full rendering of multiple fixtures.
- Test fixtures generated by `hiveplotlib`: `minimal_hive_plot.json`,
  `multi_tag_hive_plot.json`, `full_kwargs_hive_plot.json`.
- `index.html` for local visual development and sanity-checking of all fixtures.
- GitHub Actions CI (`.github/workflows/ci.yml`) running tests and build across Node 18, 20,
  and 22.
- `package.json` with npm scripts (`test`, `test:watch`, `build`).
- Minified ESM bundle build via esbuild (`npm run build`).
- `.gitignore` for `node_modules` and test coverage.
- ESLint (`eslint.config.js`) with the recommended ruleset.
- Prettier (`.prettierrc`, `.prettierignore`) for consistent code formatting.
- Pre-commit hook via husky + lint-staged — runs Prettier and ESLint on staged files.
- VS Code workspace settings (`.vscode/settings.json`) for format-on-save and recommended
  extensions (`esbenp.prettier-vscode`, `dbaeumer.vscode-eslint`).
- Dependabot (`.github/dependabot.yml`) for weekly npm and GitHub Actions dependency updates.
- `npm audit --audit-level=high` step in CI (set to `high` because the only moderate-severity
  finding is a ReDoS in `ajv`, a transitive dev dependency of ESLint — not shipped to consumers).
- Lint and format-check steps in CI.
- Test coverage reporting on PRs via `davelosert/vitest-coverage-report-action`.

# 0.1.1 (Released Jun 28, 2025)

Revising maintained support to work with the new, higher-level `hiveplotlib` API being released in version `0.26.0`.

# Changed

- Changed `example_hive_plot.json` to match results created from converting the new `HivePlot` instance to JSON, corresponding to the `hiveplotlib==0.26.0` release.

# 0.1.0 (Released Jan 21, 2024)

# Added

- First pass at JavaScript (D3) code to work off of [Hiveplotlib](https://gitlab.com/geomdata/hiveplotlib) JSON outputs.
